#!/bin/bash
# Made by liberally copying from https://github.com/halhen/shic
# The greatest form of flattery is imitation.

# Defaults
[ -z $IRC_HOST ] && IRC_HOST="irc.freenode.net"
[ -z $IRC_PORT ] && IRC_PORT=6667
[ -z $IRC_NICK ] && IRC_NICK="bash-hubot"
[ -z $IRC_PASS ] && IRC_PASS=""
[ -z $IRC_CHAN ] && IRC_CHAN="#tshdw-test"

_say () {
    printf "%s\r\n" "$*" >&3
}

# Clean up children at exit
trap "kill 0" EXIT

# Open connection to server
exec 3<>/dev/tcp/$IRC_HOST/$IRC_PORT || exit 1
echo "Connected to the server."
_say "NICK $IRC_NICK"
_say "USER $IRC_NICK localhost $IRC_HOST :$IRC_NICK"
for chan in $IRC_CHAN; do
  _say "JOIN $chan"
done

while read line; do
    list_plugins
    for plugin in $PLUGINS; do
        $plugin "$input_line" | _say &
    done
done <&3
